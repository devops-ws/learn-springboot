#!api-testing
# yaml-language-server: $schema=https://linuxsuren.github.io/api-testing/api-testing-schema.json
name: SpringBoot
api: |
  {{default "http://localhost:8080" (env "SERVER")}}
param:
  auth: Basic {{ base64 "admin:123456" }}
items:
- name: health
  request:
    api: /health
- name: toLowerWithoutParam
  request:
    api: /lower
    header:
      Authorization: "{{ .param.auth }}"
  expect:
    statusCode: 400
- name: toLower
  request:
    api: /lower
    query:
      text: Hello
    header:
      Authorization: "{{ .param.auth }}"
  expect:
    body: hello

## Cookies
- name: no-cookie
  request:
    api: /cookies/echo
    header:
      Authorization: "{{ .param.auth }}"
  expect:
    body: cookies are empty

## GraphQL
- name: queryBookById
  request:
    api: /graphql
    method: POST
    header:
      Content-Type: application/json
    body: |
      {
        "query": "query xxx($id: ID) {\n  bookById(id: $id) {\n    id\n    name\n  }\n}",
        "operationName": "xxx",
        "variables": {"id": "book-1"}
      }
  expect:
    bodyFieldsExpect:
      data.bookById.name: Effective Java
- name: allBooks
  request:
    api: /graphql
    method: POST
    header:
      Content-Type: application/json
    body: |
      {
        "query": "query xxx { books { name } }"
      }
  expect:
    verify:
      - len(data.data.books) >= 3
- name: queryBookById-not-found
  request:
    api: /graphql
    method: POST
    header:
      Content-Type: application/json
    body: |
      {
        "query": "query xxx {\n  bookById(id: \"book\") {\n    id\n    name\n  }\n}",
        "operationName": "xxx"
      }
  expect:
    verify:
      - data.bookById == nil
- name: addBook
  request:
    api: /graphql
    method: POST
    header:
      Content-Type: application/json
    body: |
      {
        "query": "mutation size { addBook(name: \"name\"\n pageCount: 1)}"
      }
